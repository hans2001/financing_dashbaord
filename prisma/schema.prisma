generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String     @id @default(cuid())
  email     String?    @unique
  displayName String?
  passwordHash String?
  isActive  Boolean    @default(true)
  role      String     @default("family")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  items     BankItem[]
}

model BankItem {
  id              String    @id @default(cuid())
  user            User      @relation(fields: [userId], references: [id])
  userId          String
  plaidItemId     String    @unique
  institutionId   String?
  institutionName String?
  accessToken     String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  lastSyncedRequestId        String?
  lastSyncedTotalTransactions Int?     @default(0)
  lastSyncedAt               DateTime?

  accounts        Account[]
}

model Account {
  id              String      @id @default(cuid())
  bankItem        BankItem    @relation(fields: [bankItemId], references: [id])
  bankItemId      String
  plaidAccountId  String      @unique
  name            String
  officialName    String?
  mask            String?
  type            String
  subtype         String?
  currency        String?
  currentBalance   Decimal?
  availableBalance Decimal?
  creditLimit      Decimal?
  balanceLastUpdated DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  transactions    Transaction[]
}

model Transaction {
  id                 String    @id @default(cuid())
  account            Account   @relation(fields: [accountId], references: [id])
  accountId          String
  plaidTransactionId String    @unique
  date               DateTime
  name               String
  merchantName       String?
  description        String?
  amount             Decimal
  isoCurrencyCode    String?
  pending            Boolean
  category           String[]
  normalizedCategory String    @default("Uncategorized")
  raw                Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}
